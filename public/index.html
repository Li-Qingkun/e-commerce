<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>放单计划管理系统</title>
		<!-- 主图标（推荐16x16/32x32像素，png/ico格式） -->
		<link rel="icon" href="./images/logo.png" type="image/png">
		<!-- 兼容旧版IE的ico格式（可选） -->
		<link rel="shortcut icon" href="./images/logo.png" type="image/x-icon">
		<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="css/style.css">
	</head>
	<body oncontextmenu="return false;">
		<!-- 顶部导航栏 - 优化移动端布局 -->
		<nav class="navbar navbar-custom">
			<div class="container-fluid">
				<div class="navbar-header">
					<a class="navbar-brand" href="#">
						<img src="images/logo.png" alt="logo">
						<span class="system-name">放单计划管理系统</span>
					</a>
					<!-- 移动端店铺切换触发按钮 -->
					<div class="shop-mobile-toggle" id="shopMobileToggle">
						<i class="fa fa-store"></i> 切换店铺
					</div>
				</div>

				<!-- 店铺切换按钮组 -->
				<div class="shop-switcher" id="shopSwitcher">
					<span class="shop-label">当前店铺：</span>
					<div class="shop-btn-group" id="shopBtnGroup">
						<!-- 店铺按钮会通过JS动态生成 -->
					</div>
				</div>

				<!-- 动态菜单容器（替换原有写死的菜单） -->
				<div class="nav-menu-area" id="dynamicMenuContainer">
					<ul class="nav-menu-list" id="mainMenuList">
						<!-- 菜单会通过JS动态生成 -->
					</ul>
				</div>

				<div class="navbar-right nav-user-area">
					<div class="user-dropdown" id="userDropdown">
						<span class="user-info" id="userNameDisplay">登录用户：</span>
						<i class="fa fa-caret-down"></i>
						<div class="dropdown-menu" id="userMenu">
							<div class="dropdown-item" id="btnChangePwd">
								<i class="fa fa-key"></i> 修改密码
							</div>
							<div class="dropdown-item" id="btnAddShop">
								<i class="fa fa-store"></i> 新增店铺
							</div>
							<!-- 新增：充值记录选项 -->
							<div class="dropdown-item" id="btnRechargeRecord">
								<i class="fa fa-history"></i> 充值记录
							</div>
							<div class="dropdown-item" id="btnAdminLogout">
								<i class="fa fa-sign-out"></i> 退出登录
							</div>
						</div>
					</div>
				</div>
			</div>
		</nav>

		<!-- 内容容器 - 保留原有结构 -->
		<div class="main-container">
			<!-- 功能按钮区 -->
			<div class="btn-toolbar">
				<div class="btn-group left-btn-group">
					<button class="btn btn-primary" id="btnAdd">
						<i class="fa fa-plus"></i> 新增计划
					</button>
					<button class="btn btn-warning" id="btnLoadData">
						<i class="fa fa-refresh"></i> 加载数据
					</button>
					<button class="btn btn-info" id="btnCompareTodayTomorrow">
						<i class="fa fa-calendar-check-o"></i> 今日/明日计划对比
					</button>
					<button class="btn btn-info" id="btnCompareYesterdayToday">
						<i class="fa fa-calendar-check-o"></i> 昨日/今日计划对比
					</button>
				</div>
				<div class="btn-group right-btn-group">
					<button class="btn btn-primary active" id="btnShowTimeline">
						<i class="fa fa-timeline"></i> 时间轴视图
					</button>
					<button class="btn btn-default" id="btnShowTable">
						<i class="fa fa-table"></i> 表格视图
					</button>
				</div>
			</div>

			<!-- 时间轴容器 -->
			<div id="timelineContainerWrapper" class="content-wrapper">
				<div id="timelineContainer" class="timeline-container">
					<div id="timelineHeader" class="timeline-header"></div>
					<div id="timelineContent" class="timeline-content"></div>
				</div>
			</div>

			<!-- 表格容器 -->
			<div id="tableContainer" class="content-wrapper" style="display: none;">
				<table class="table table-bordered table-hover">
					<thead>
						<tr>
							<th>链接商品ID</th>
							<th>链接商品名称</th>
							<th>SKU名称</th>
							<th>SKU价格</th>
							<th>创建时间</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody id="planTableBody"></tbody>
				</table>
			</div>
		</div>

		<!-- 新增/编辑模态框 -->
		<div class="modal fade" id="editModal" tabindex="-1" role="dialog">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" id="modalTitle">计划编辑</h4>
					</div>
					<div class="modal-body">
						<form id="planForm">
							<div class="form-group hidden">
								<label for="txtID">计划ID</label>
								<input type="text" class="form-control" id="txtID" readonly>
							</div>
							<input type="hidden" id="originalId">
							<input type="hidden" id="editMode" value="add">

							<div class="form-group">
								<label for="txtCode">链接商品ID</label>
								<input type="text" class="form-control" id="txtCode" placeholder="请输入链接商品ID">
							</div>
							<div class="form-group">
								<label for="txtName">链接商品名称 <span class="required">*</span></label>
								<input type="text" class="form-control" id="txtName" placeholder="请输入链接商品名称">
							</div>
							<div class="form-group">
								<label for="txtSkuName">SKU名称</label>
								<input type="text" class="form-control" id="txtSkuName" placeholder="请输入SKU名称">
							</div>
							<div class="form-group">
								<label for="txtSkuPrice">SKU售价</label>
								<input type="number" step="0.01" class="form-control" id="txtSkuPrice"
									placeholder="请输入SKU售价">
							</div>
							<div class="form-group hidden">
								<label for="txtCreateTime">创建时间</label>
								<input type="datetime-local" class="form-control" id="txtCreateTime">
							</div>

							<div class="form-group">
								<label>放单明细 <span class="required">*</span></label>
								<button type="button" class="btn btn-sm btn-success" id="btnAddDetail">
									<i class="fa fa-plus"></i> 添加明细
								</button>
								<button type="button" class="btn btn-sm btn-info" id="btnBatchInitDetail"
									style="margin-left: 8px;">
									<i class="fa fa-refresh"></i> 批量初始化
								</button>
								<table class="table table-bordered" id="detailTable">
									<thead>
										<tr>
											<th>放单日期</th>
											<th>放单数量</th>
											<th>放单词</th>
											<th>操作</th>
										</tr>
									</thead>
									<tbody id="detailTableBody"></tbody>
								</table>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button type="button" class="btn btn-primary" id="btnSaveForm">保存</button>
					</div>
				</div>
			</div>
		</div>

		<!-- 今日/明日对比弹窗 -->
		<div id="compareModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" id="compareModalTitle">
							<i class="fa fa-calendar"></i> 今日/明日计划对比
						</h4>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label>对比结果（可直接复制）：</label>
							<textarea id="compareResult" class="form-control" rows="15" readonly
								style="font-family: monospace;"></textarea>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
						<button type="button" class="btn btn-info" id="btnCopyCompare">
							<i class="fa fa-copy"></i> 复制内容
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- 修改密码模态框 -->
		<div class="modal fade" id="changePwdModal" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title">
							<i class="fa fa-key"></i> 修改密码
						</h4>
					</div>
					<div class="modal-body">
						<form id="changePwdForm">
							<div class="form-group">
								<label for="oldPwd">旧密码 <span class="required">*</span></label>
								<input type="password" class="form-control" id="oldPwd" placeholder="请输入旧密码" required>
							</div>
							<div class="form-group">
								<label for="newPwd">新密码 <span class="required">*</span></label>
								<input type="password" class="form-control" id="newPwd" placeholder="请输入新密码" required>
							</div>
							<div class="form-group">
								<label for="confirmPwd">确认新密码 <span class="required">*</span></label>
								<input type="password" class="form-control" id="confirmPwd" placeholder="请再次输入新密码"
									required>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button type="button" class="btn btn-primary" id="btnSavePwd">保存修改</button>
					</div>
				</div>
			</div>
		</div>

		<!-- 新增店铺模态框 -->
		<div class="modal fade" id="addShopModal" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title">
							<i class="fa fa-store"></i> 新增店铺
						</h4>
					</div>
					<div class="modal-body">
						<form id="addShopForm">
							<div class="form-group">
								<label for="newShopName">店铺名称 <span class="required">*</span></label>
								<input type="text" class="form-control" id="newShopName" placeholder="请输入新增店铺名称"
									required>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button type="button" class="btn btn-primary" id="btnSaveShop">确认新增</button>
					</div>
				</div>
			</div>
		</div>

		<!-- 新增：充值记录模态框 -->
		<div class="modal fade" id="rechargeRecordModal" tabindex="-1" role="dialog">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title">
							<i class="fa fa-history"></i> 充值记录查询
						</h4>
					</div>
					<div class="modal-body">
						<div class="recharge-table-wrapper">
							<table class="table table-bordered table-hover recharge-table">
								<thead>
									<tr>
										<!-- <th>充值ID</th> -->
										<th>充值金额</th>
										<th>充值时长</th>
										<!-- <th>充值类型</th> -->
										<th>支付方式</th>
										<th>支付状态</th>
										<!-- <th>原到期时间</th> -->
										<th>到期时间</th>
										<!-- <th>操作人</th> -->
										<th>放单词</th>
										<th>充值时间</th>
									</tr>
								</thead>
								<tbody id="rechargeRecordTableBody"></tbody>
							</table>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					</div>
				</div>
			</div>
		</div>

		<!-- 新增批量初始化明细的模态框 -->
		<div class="modal fade" id="batchInitModal" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title">
							<i class="fa fa-calendar"></i> 批量初始化放单明细
						</h4>
					</div>
					<div class="modal-body">
						<form id="batchInitForm">
							<div class="form-group">
								<label for="defaultInitDays">默认初始化天数 <span class="required">*</span></label>
								<select class="form-control" id="defaultInitDays" required>
									<option value="">请选择初始化天数</option>
								</select>
							</div>
							<div class="form-group">
								<label for="singleQuantity">单日放单数量 <span class="required">*</span></label>
								<input type="number" class="form-control" id="singleQuantity" min="1" value="2"
									placeholder="请输入单日放单数量（会自动按天数生成）">
							</div>
							<div class="form-group">
								<label for="batchStartDate">开始日期 <span class="required">*</span></label>
								<input type="date" class="form-control" id="batchStartDate" required>
							</div>
							<div class="form-group">
								<label for="batchEndDate">结束日期 <span class="required">*</span></label>
								<input type="date" class="form-control" id="batchEndDate" required>
							</div>
							<div class="form-group">
								<label for="batchQuantities">放单数量 <span class="required">*</span></label>
								<input type="text" class="form-control" id="batchQuantities"
									placeholder="例如：2,2,2,2（英文逗号分隔，数量需与日期天数匹配）">
								<small class="text-muted">提示：数量个数需等于开始日期到结束日期的天数</small>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button type="button" class="btn btn-primary" id="btnConfirmBatchInit">确认初始化</button>
					</div>
				</div>
			</div>
		</div>

		<!-- 新增：订单查询模态框 -->
		<div class="modal fade" id="qnzgOrderModal" tabindex="-1" role="dialog">
			<div class="modal-dialog modal-xl" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title">
							<i class="fa fa-search"></i> 查询订单信息
						</h4>
					</div>
					<div class="modal-body">
						<!-- 查询条件区域 -->
						<div class="query-condition-wrapper"
							style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
							<div class="row">
								<div class="col-md-4">
									<div class="form-group">
										<label for="queryShopName">店铺名称</label>
										<select class="form-control" id="queryShopName">
											<!-- 店铺选项会通过JS动态生成 -->
										</select>
									</div>
								</div>
								<div class="col-md-4">
									<div class="form-group">
										<label for="queryDate">查询日期</label>
										<input type="date" class="form-control" id="queryDate">
									</div>
								</div>
								<div class="col-md-4" style="display: flex; align-items: flex-end;">
									<button type="button" class="btn btn-primary" id="btnQueryOrder">
										<i class="fa fa-search"></i> 查询
									</button>
									<button type="button" class="btn btn-default" id="btnResetQuery"
										style="margin-left: 10px;">
										<i class="fa fa-refresh"></i> 重置
									</button>
								</div>
							</div>
						</div>

						<!-- 订单表格区域 -->
						<div class="order-table-wrapper" style="overflow-x: auto; max-height: 600px; overflow-y: auto;">
							<table class="table table-bordered table-hover" id="orderResultTable">
								<thead>
									<tr>
										<th>商品ID</th>
										<th>日期</th>
										<th>店铺</th>
										<th>内部单号</th>
										<th>线上订单号</th>
										<th>飞鸽账号</th>
										<th>本金</th>
										<th>佣金</th>
										<th>金币</th>
										<th>评价花费</th>
										<th>合计</th>
										<th>备注</th>
										<th>佣金合计</th>
									</tr>
								</thead>
								<tbody id="orderResultTableBody">
									<tr>
										<td colspan="13" class="text-center text-muted">请点击查询按钮获取订单数据</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
						<button type="button" class="btn btn-info" id="btnCopyOrderTable">
							<i class="fa fa-copy"></i> 复制表格内容
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- 售价信息记录 - 查看模态框 -->
		<div class="modal fade" id="priceRecordViewModal" tabindex="-1" role="dialog">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" id="priceRecordViewTitle">
							<i class="fa fa-table"></i> 售价信息记录（<span id="currentShopViewTitle">默认店铺</span>）
						</h4>
					</div>
					<div class="modal-body">
						<div class="table-responsive">
							<table class="table table-bordered table-striped" id="priceRecordViewTable">
								<thead>
									<tr style="background-color: #ffeb3b; color: #000;">
										<th colspan="5" class="text-center">
											<h4 style="margin: 0;"><span id="viewTableTitle">得力脚垫售价</span></h4>
										</th>
									</tr>
									<tr style="background-color: #ffeb3b; color: #000;">
										<th>SKU名称</th>
										<th>售价</th>
										<th>优惠券</th>
										<th>直降值</th>
										<th>一口价</th>
									</tr>
								</thead>
								<tbody id="priceRecordViewBody">
									<!-- 数据由JS动态填充 -->
								</tbody>
							</table>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-warning" id="btnEditPriceRecord">
							<i class="fa fa-edit"></i> 修改信息
						</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					</div>
				</div>
			</div>
		</div>

		<!-- 售价信息记录模态框 -->
		<div class="modal fade" id="priceRecordModal" tabindex="-1" role="dialog">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" id="priceRecordTitle">
							<i class="fa fa-calculator"></i> 售价信息记录（<span id="currentShopTitle">默认店铺</span>）
						</h4>
					</div>
					<div class="modal-body">
						<!-- 优惠券配置区 -->
						<div class="coupon-config-wrapper"
							style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
							<h5><i class="fa fa-ticket"></i> 优惠券档位配置</h5>
							<div class="coupon-list" id="couponList">
								<div class="coupon-item row" style="margin-bottom: 10px; align-items: center;">
									<div class="col-md-5">
										<input type="number" class="form-control coupon-threshold" placeholder="满X元"
											min="1" value="50">
									</div>
									<div class="col-md-5">
										<input type="number" class="form-control coupon-value" placeholder="减X元" min="1"
											value="10">
									</div>
									<div class="col-md-2">
										<button type="button"
											class="btn btn-danger btn-sm btn-remove-coupon">删除</button>
									</div>
								</div>
								<div class="coupon-item row" style="margin-bottom: 10px; align-items: center;">
									<div class="col-md-5">
										<input type="number" class="form-control coupon-threshold" placeholder="满X元"
											min="1" value="100">
									</div>
									<div class="col-md-5">
										<input type="number" class="form-control coupon-value" placeholder="减X元" min="1"
											value="30">
									</div>
									<div class="col-md-2">
										<button type="button"
											class="btn btn-danger btn-sm btn-remove-coupon">删除</button>
									</div>
								</div>
							</div>
							<button type="button" class="btn btn-sm btn-success" id="btnAddCoupon">
								<i class="fa fa-plus"></i> 添加优惠券档位
							</button>
						</div>

						<!-- 直降类型选择 -->
						<div class="form-group">
							<label>直降类型 <span class="required">*</span></label>
							<select class="form-control" id="priceReduceType">
								<option value="direct">直降（减固定金额）</option>
								<option value="discount">打折（乘以折扣/10）</option>
							</select>
						</div>

						<!-- 核心计算表单 -->
						<table class="table table-bordered" id="priceCalcTable">
							<thead>
								<tr>
									<th>SKU名称</th>
									<th>售价（自动计算/反推）</th>
									<th>优惠券（自动匹配）</th>
									<th>直降值</th>
									<th>一口价</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody id="priceTableBody">
								<!-- 初始行 -->
								<tr class="price-row">
									<td><input type="text" class="form-control sku-name" placeholder="如：单五脚垫"></td>
									<td><input type="number" class="form-control price" step="0.01"
											placeholder="自动计算/手动输入"></td>
									<td><input type="number" class="form-control coupon" step="0.01" readonly
											placeholder="自动匹配"></td>
									<td><input type="number" class="form-control reduce-value" step="0.01"
											placeholder="直降金额/折扣数"></td>
									<td><input type="number" class="form-control final-price" step="0.01"
											placeholder="自动反推/手动输入"></td>
									<td><button type="button" class="btn btn-danger btn-sm btn-remove-row">删除</button>
									</td>
								</tr>
							</tbody>
						</table>
						<button type="button" class="btn btn-sm btn-success" id="btnAddPriceRow">
							<i class="fa fa-plus"></i> 添加SKU行
						</button>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
						<button type="button" class="btn btn-primary" id="btnSavePriceRecord">保存记录</button>
					</div>
				</div>
			</div>
		</div>

		<!-- 自定义右键菜单 -->
		<div class="custom-contextmenu" id="planContextMenu">
			<div class="custom-contextmenu-item" id="copyPlanItem">复制</div>
			<div class="custom-contextmenu-item" id="deletePlanItem">删除</div>
			<!-- 新增：晒图状态切换选项 -->
			<div class="custom-contextmenu-item" id="togglePostPictureItem">已晒图/未晒图</div>
		</div>

		<!-- Toast提示容器 -->
		<div class="toast-container" id="toastContainer"></div>

		<!-- 引入JS -->
		<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
		<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js"></script>
		<script src="js/script.js"></script>
	</body>
</html>